<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’ Swiss Cup Crawler</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ’ Swiss Cup Crawler</h1>
        
        <div class="status-banner">
            <strong>Automatischer Modus aktiv:</strong> Alle Cups ab Saison 2022/23 werden beim Server-Start automatisch gecrawlt und die Bracket-Sortierung wird berechnet.
        </div>
        
        <div class="navigation-section">
            <h2>ğŸš€ VerfÃ¼gbare Tools</h2>
            
            <div class="tool-grid">
                <div class="tool-card">
                    <div class="tool-icon">ğŸ†</div>
                    <h3>Bracket Viewer</h3>
                    <p>Interaktive Darstellung der Tournament-Brackets mit Team-Highlighting und Verbindungslinien</p>
                    <a href="/Alt/bracket.html" class="btn btn-primary">
                        ğŸ¯ Bracket Ã¶ffnen
                    </a>
                </div>

                <div class="tool-card">
                    <div class="tool-icon">ğŸ†</div>
                    <h3>Smart Bracket Viewer</h3>
                    <p>Interaktive Darstellung der Tournament-Brackets mit Team-Highlighting und Verbindungslinien</p>
                    <a href="/smartbracket.html" class="btn btn-primary">
                        ğŸ¯ Bracket Ã¶ffnen
                    </a>
                </div>
                
                <div class="tool-card">
                    <div class="tool-icon">ğŸ“Š</div>
                    <h3>Datenbank Review</h3>
                    <p>Detaillierte Ãœbersicht aller gecrawlten Spiele mit Statistiken und Exportfunktionen</p>
                    <a href="/dev/dbreview.html" class="btn btn-success">
                        ğŸ“‹ DB Review Ã¶ffnen
                    </a>
                </div>

                <div class="tool-card">
                    <div class="tool-icon">ğŸ®</div>
                    <h3>GameDetails Review</h3>
                    <p>Detaillierte Ansicht aller Game-Events, Tore, Strafen und Spielstatistiken</p>
                    <a href="/dev/gamedetails.html" class="btn btn-success">
                        ğŸ® GameDetails Ã¶ffnen
                    </a>
                </div>
            </div>
        </div>

        <!-- Backend Interface Section -->
        <div class="backend-interface-section">
            <h2>âš™ï¸ Backend Interface</h2>
            
            <div class="alert alert-info">
                <strong>Info:</strong> Hier kÃ¶nnen Sie Funktionen nachtrÃ¤glich ausfÃ¼hren, die beim Server-Start Ã¼bersprungen wurden.
            </div>
            
            <div class="backend-grid">
                <div class="backend-card">
                    <div class="backend-icon">ğŸ’</div>
                    <h3>Quick Update</h3>
                    <p>Aktuelle Saison crawlen + Bracket-Sortierung + Prognose-Spiele fÃ¼r alle 4 Cups</p>
                    <button class="btn btn-warning" onclick="executeQuickUpdate()">
                        âš¡ Quick Update starten
                    </button>
                    <div class="backend-status" id="quickUpdateStatus"></div>
                </div>
                
                <div class="backend-card">
                    <div class="backend-icon">ğŸ“¥</div>
                    <h3>Cup-Daten Crawling</h3>
                    <p>Crawle Cup-Daten fÃ¼r gewÃ¤hlte Saison</p>
                    <select class="season-select" id="crawlSeasonSelect">
                        <option value="2025/26">2025/26 (Aktuell)</option>
                        <option value="all">Alle Saisons</option>
                        <option value="2024/25">2024/25</option>
                        <option value="2023/24">2023/24</option>
                        <option value="2022/23">2022/23</option>
                    </select>
                    <button class="btn btn-info" onclick="executeCrawling()">
                        ğŸ“¡ Crawling starten
                    </button>
                    <div class="backend-status" id="crawlingStatus"></div>
                </div>
                
                <div class="backend-card">
                    <div class="backend-icon">ğŸ¯</div>
                    <h3>Bracket-Sortierung</h3>
                    <p>Berechne Tournament-Bracket Sortierung</p>
                    <select class="season-select" id="bracketSeasonSelect">
                        <option value="2025/26">2025/26 (Aktuell)</option>
                        <option value="all">Alle Saisons</option>
                        <option value="2024/25">2024/25</option>
                        <option value="2023/24">2023/24</option>
                        <option value="2022/23">2022/23</option>
                    </select>
                    <button class="btn btn-success" onclick="executeBracketSorting()">
                        ğŸ”¢ Berechnung starten
                    </button>
                    <div class="backend-status" id="bracketStatus"></div>
                </div>
                
                <div class="backend-card">
                    <div class="backend-icon">ğŸ”®</div>
                    <h3>Prognose-Spiele</h3>
                    <p>Generiere Prognose-Spiele fÃ¼r aktuelle Saison</p>
                    <div class="prognose-actions">
                        <button class="btn btn-danger btn-small" onclick="executePrognoseCleanup()">
                            ğŸ—‘ï¸ Cleanup
                        </button>
                        <button class="btn btn-primary btn-small" onclick="executePrognoseGenerate()">
                            âš¡ Generieren
                        </button>
                    </div>
                    <div class="backend-status" id="prognoseStatus"></div>
                </div>
            </div>
        </div>
        
        <div class="status-section">
            <h2>ğŸ“ˆ System Status</h2>
            <div class="status-grid">
                <div class="status-item">
                    <span class="status-label">Server Status</span>
                    <span class="status-value status-active" id="serverStatus">ğŸŸ¢ Online</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Auto-Crawl</span>
                    <span class="status-value" id="autoCrawlStatus">â³ LÃ¤uft...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Letzte Aktualisierung</span>
                    <span class="status-value" id="lastUpdate">-</span>
                </div>
            </div>
        </div>
        
        <div class="quick-stats">
            <div class="stat-card">
                <span class="stat-value" id="totalGames">-</span>
                <span class="stat-label">Spiele Total</span>
            </div>
            <div class="stat-card">
                <span class="stat-value" id="totalEvents">-</span>
                <span class="stat-label">Events</span>
            </div>
            <div class="stat-card">
                <span class="stat-value" id="bracketSorted">-</span>
                <span class="stat-label">Bracket-sortiert</span>
            </div>
        </div>
        
        <div class="admin-section">
            <h2>âš™ï¸ Admin Tools</h2>
            <div class="admin-buttons">
                <a href="/stats" class="btn btn-info btn-small">ğŸ“Š Statistiken</a>
                <a href="/games/all" class="btn btn-info btn-small">ğŸ“‹ Alle Spiele</a>
                <a href="/bracket-sorting-status" class="btn btn-info btn-small">ğŸ¯ Bracket Status</a>
                <a href="/health" class="btn btn-success btn-small">â¤ï¸ Health Check</a>
            </div>
        </div>
    </div>

    <script>
        // Backend Interface Functions
        async function executeQuickUpdate() {
            updateBackendStatus('quickUpdateStatus', 'â³ Quick Update wird ausgefÃ¼hrt...', 'loading');
            
            try {
                const response = await fetch('/api/backend/quick-update', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    updateBackendStatus('quickUpdateStatus', 'âœ… Quick Update erfolgreich abgeschlossen', 'success');
                } else {
                    updateBackendStatus('quickUpdateStatus', `âŒ Fehler: ${result.error}`, 'error');
                }
            } catch (error) {
                updateBackendStatus('quickUpdateStatus', `âŒ Verbindungsfehler: ${error.message}`, 'error');
            }
        }
        
        async function executeCrawling() {
            const season = document.getElementById('crawlSeasonSelect').value;
            updateBackendStatus('crawlingStatus', `â³ Crawling ${season} wird ausgefÃ¼hrt...`, 'loading');
            
            try {
                const endpoint = season === 'all' ? '/api/backend/crawl-all' : '/api/backend/crawl-season';
                const body = season === 'all' ? {} : { season };
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    updateBackendStatus('crawlingStatus', `âœ… Crawling abgeschlossen: ${result.summary}`, 'success');
                } else {
                    updateBackendStatus('crawlingStatus', `âŒ Fehler: ${result.error}`, 'error');
                }
            } catch (error) {
                updateBackendStatus('crawlingStatus', `âŒ Verbindungsfehler: ${error.message}`, 'error');
            }
        }
        
        async function executeBracketSorting() {
            const season = document.getElementById('bracketSeasonSelect').value;
            updateBackendStatus('bracketStatus', `â³ Bracket-Sortierung ${season} wird berechnet...`, 'loading');
            
            try {
                const endpoint = season === 'all' ? '/api/backend/bracket-all' : '/api/backend/bracket-season';
                const body = season === 'all' ? {} : { season };
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    updateBackendStatus('bracketStatus', 'âœ… Bracket-Sortierung erfolgreich berechnet', 'success');
                } else {
                    updateBackendStatus('bracketStatus', `âŒ Fehler: ${result.error}`, 'error');
                }
            } catch (error) {
                updateBackendStatus('bracketStatus', `âŒ Verbindungsfehler: ${error.message}`, 'error');
            }
        }
        
        async function executePrognoseCleanup() {
            updateBackendStatus('prognoseStatus', 'â³ Prognose-Spiele werden gelÃ¶scht...', 'loading');
            
            try {
                const response = await fetch('/api/backend/prognose-cleanup', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    updateBackendStatus('prognoseStatus', `âœ… Cleanup abgeschlossen: ${result.deleted} Spiele gelÃ¶scht`, 'success');
                } else {
                    updateBackendStatus('prognoseStatus', `âŒ Fehler: ${result.error}`, 'error');
                }
            } catch (error) {
                updateBackendStatus('prognoseStatus', `âŒ Verbindungsfehler: ${error.message}`, 'error');
            }
        }
        
        async function executePrognoseGenerate() {
            updateBackendStatus('prognoseStatus', 'â³ Prognose-Spiele werden generiert...', 'loading');
            
            try {
                const response = await fetch('/api/backend/prognose-generate', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    updateBackendStatus('prognoseStatus', `âœ… Generierung abgeschlossen: ${result.generated} Spiele`, 'success');
                } else {
                    updateBackendStatus('prognoseStatus', `âŒ Fehler: ${result.error}`, 'error');
                }
            } catch (error) {
                updateBackendStatus('prognoseStatus', `âŒ Verbindungsfehler: ${error.message}`, 'error');
            }
        }
        
        function updateBackendStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `backend-status ${type}`;
        }
        
        // Existing status update functions
        async function updateStatus() {
            try {
                const statsResponse = await fetch('/stats');
                const stats = await statsResponse.json();
                
                if (stats.totalGames !== undefined) {
                    document.getElementById('totalGames').textContent = stats.totalGames.toLocaleString();
                    document.getElementById('totalEvents').textContent = stats.totalTournaments || '-';
                    document.getElementById('lastUpdate').textContent = new Date().toLocaleString('de-CH');
                }
                
                const bracketResponse = await fetch('/bracket-sorting-status');
                const bracketStats = await bracketResponse.json();
                
                if (bracketStats.success) {
                    const totalSorted = bracketStats.events.reduce((sum, event) => sum + event.sortedGames, 0);
                    document.getElementById('bracketSorted').textContent = totalSorted.toLocaleString();
                }
                
                document.getElementById('autoCrawlStatus').innerHTML = 'âœ… Abgeschlossen';
                document.getElementById('autoCrawlStatus').className = 'status-value status-active';
                
            } catch (error) {
                console.error('Status update failed:', error);
                document.getElementById('autoCrawlStatus').innerHTML = 'âŒ Fehler';
                document.getElementById('autoCrawlStatus').className = 'status-value status-error';
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus();
            setInterval(updateStatus, 30000);
        });
        
        setInterval(async () => {
            try {
                const response = await fetch('/health');
                const status = response.ok ? 'ğŸŸ¢ Online' : 'ğŸ”´ Fehler';
                document.getElementById('serverStatus').textContent = status;
                document.getElementById('serverStatus').className = response.ok ? 
                    'status-value status-active' : 'status-value status-error';
            } catch (error) {
                document.getElementById('serverStatus').textContent = 'ğŸ”´ Offline';
                document.getElementById('serverStatus').className = 'status-value status-error';
            }
        }, 10000);
    </script>
</body>
</html>